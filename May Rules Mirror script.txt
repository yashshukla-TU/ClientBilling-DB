use billing_v2;
INSERT INTO ClientBillingRules
select 
	'2023-05-01' [Start Date]
	,'2023-05-31' [End Date]
	,A.projid
	,A.lob
	,A.[site]
	,A.position
	,A.billability_category
	,A.lower_max
	,A.upper_max
	,A.billable_headcount
	,A.round_per_minutes
	,A.grace_period_minutes
	,A.spillover_mins
	,A.working_days
	,A.regular_price_hr
	,A.holiday_price_hr
	,A.overtime_price_hr
	,A.Inserted_Date
	,A.Inserted_By
	,A.Updated_Date
	,A.Updated_By
	,A.IsActive
	,A.Comments
	,A.LOB_Alias
from ClientBillingRules as a 
LEFT join (select * from ClientBillingRules where start_date = '2023-05-01' and isactive=1) as b 
	ON  A.projid = B.projid AND A.LOB = B.lob AND A.site = B.site AND A.position = B.position
WHERE B.projid IS NULL AND A.start_date ='2023-04-01' AND A.IsActive =1